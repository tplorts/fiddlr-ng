{% extends "pagebase.html" %}
{% load misc staticfiles angular %}


{% block html_attributes %}
ng-app="exploreApp"
{% endblock %}


{% block prescripts %}
<script>
  var initialEvents = {{ featured_events_json|safe }};
</script>
<script src="{% static 'my/scripts/explore-map.js' %}"></script>
{% endblock %}


{% block content %}
<div ng-controller="ExploreController">

  <div id="gmap-explore">
    <google-map center="map.center" 
                zoom="map.zoom"
                pan="false"
                draggable="true">
      <marker ng-repeat="e in events"
              coords="e.coords"
              events="markerEvents">
      </marker>
    </google-map>
  </div>


  <div id="leave-map-link">
    <a href="{% url 'Featured' %}" class="btn btn-info bold purple">
      Leave map view
    </a>
  </div>

  <div id="featured-events">
    <accordion close-others="false">
      {% for e in featured_events %}
      <accordion-group class="event-item" event-id="{{ e.pk }}">
        <accordion-heading>
          <span class="event-name">{{ e.name }}</span>
          <span class="event-venue">@ {{ e.venue.name }}</span>
        </accordion-heading>
        <div>
          {{ e.brief|default:"Dear me! There's no brief description!" }}
        </div>
        <div>
          {{ e.start|default:"Don't know from when" }} 
          &mdash; 
          {{ e.end|default:"Don't know till when" }}
        </div>
      </accordion-group>
      {% endfor %}
    </accordion>
  </div>

</div>
{% endblock %}


{% block postscripts %}
<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
<script src="http://maps.googleapis.com/maps/api/js?key={{ gmaps_api_key }}&sensor=true"></script>

{% angular %}
<script src="{% static '3p/scripts/angular-google-maps.min.js' %}"></script>
<script src="{% static '3p/scripts/ui-bootstrap-tpls-0.11.0.min.js' %}"></script>
{% angular_app "explore-map" %}

{% endblock postscripts %}

