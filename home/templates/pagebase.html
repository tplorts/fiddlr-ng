{% extends "base.html" %}
{% load staticfiles misc %}


{% block body_attributes %}ng-app="fiddlrApp"{% endblock %}


{% block super_content %}
<div id="header" ng-controller="CommonHeaderController">
  <div class="container full-width">
    <div class="row">
      <div class="col-sm-2 col-xs-3">
        <div class="ib vmid fiddlr-title">
          <a href="{% url 'Front' %}">fiddlr</a>
        </div>
      </div>
      {% if page != "front" %}
      <div class="hidden-xs">
        <div class="col-sm-6">
          <form action="{% url 'Search' %}" method="POST">
            {% csrf_token %}
            <div class="ib vmid">
              <input type="text" class="form-control"
                     name="what" placeholder="what?" />
            </div>
            <div class="ib vmid">
              <input type="text" class="form-control"
                     name="where" placeholder="where?" />
            </div>
            <div class="ib vmid">
              <button class="btn btn-default search-button"
                      type="submit">
                <span class="glyphicon glyphicon-search"></span>
              </button>
            </div>
          </form>
        </div>
      </div>
      <div class="col-sm-4 col-xs-9">
        <div class="ib vmid" id="alerts-icon">
          <a class="btn btn-default"
             href="{% url 'Alerts' %}">
            <span class="glyphicon glyphicon-bell"></span>
            <span class="badge">482</span>
          </a>
        </div>
        <div class="ib vmid" id="header-links">
          <div class="btn-group">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
              <span class="hidden-xs hidden-sm">Pages</span>
              <span class="glyphicon glyphicon-chevron-down"></span>
            </button>
            <ul class="dropdown-menu menu-align-right-edge" role="menu">
              {% for link in "Home,,Explore,Create,Connect,,About,Copyright,Help,Ads"|split:"," %}
                {% if link == "" %}
                  <li role="presentation" class="divider"></li>
                {% else %}
                  <li role="presentation">
                    <a href="{% url link %}" role="menuitem" tabindex="-1">
                      {{ link }}
                    </a>
                  </li>
                {% endif %}
              {% endfor %}
            </ul>
          </div>
        </div>
        <div class="ib vmid">
          {% if user.is_authenticated %}
          <form action="{% url 'Logout' %}" method="POST">
            {% csrf_token %}
            <input type="hidden" name="next" value="/" />
            <button class="btn btn-primary">
              sign out
            </button>
          </form>
          {% else %}
          <script type="text/ng-template" id="login-modal.html">
            <div class="modal-header">
              <div class="btn-group btn-group-justified">
                <label class="btn btn-primary" ng-model="signDirection" btn-radio="'in'">
                  Sign in
                </label>
                <label class="btn btn-primary" ng-model="signDirection" btn-radio="'up'">
                  Sign up
                </label>
              </div>
            </div>
            <div class="modal-body">
              <div ng-show="signDirection == 'in'">
                <form action="{% url 'Login' %}" method="POST">
                  {% csrf_token %}
                  <input type="hidden" name="next" 
                         value="{{ request.get_full_path }}" />
                  <p><input type="text" name="username" 
                            placeholder="username"
                            class="form-control" /></p>
                  <p><input type="password" name="password"
                            placeholder="password"
                            class="form-control" /></p>
                  <button type="submit" class="btn btn-primary purple pull-right">
                    sign in
                  </button>
                </form>
              </div>
              <div ng-show="signDirection == 'up'">
                <form action="{#% url 'Signup' %#}" method="POST" name="signup">
                  {% csrf_token %}
                  <div class="form-group has-feedback labelless
                              [[ signup.username.$invalid ? 'has-error' : (isUsernameTaken ? 'has-warning' : 'has-success') ]]">
                    <input type="text" class="form-control" id="signup-username"
                           name="username" placeholder="choose a username"
                           ng-model="pending.username"
                           ng-model-options="{ updateOn: 'default usernameChecked', debounce: {default: 0, usernameChecked: 250} }"
                           ng-pattern="/^[\w\d\-\.\+\@\_]*$/"
                           maxlength="30"
                           ng-change="usernameChanged(signup.username.$error)"
                           tooltip="[[ usernameTooltip ]]"
                           tooltip-trigger="showUsernameTooltip" />
                    {% comment %}
                    <span ng-show="signup.username.$valid && !isUsernameTaken"
                          class="glyphicon glyphicon-ok form-control-feedback"></span>
                    <span ng-show="isUsernameTaken"
                          class="glyphicon glyphicon-warning-sign form-control-feedback"></span>
                    <span ng-show="signup.username.$invalid"
                          class="glyphicon glyphicon-remove form-control-feedback"></span>
                    {% endcomment %}
                  </div>
                  <div class="form-group [[ signup.password.$valid ? '' : 'has-error' ]]">
                    <input type="password" class="form-control"
                           name="password" placeholder="password"
                           ng-model="pendingPassword" />
                  </div>                  
                  <button type="submit" class="btn btn-primary purple pull-right">
                    create an account
                  </button>
                </form>
              </div>
              <button class="btn btn-default" ng-click="jk()">never mind</button>
            </div>
          </script>
          <button class="btn btn-primary"
                  ng-click="openLoginModal()">
            sign in &amp; up
          </button>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div><!--/#header-->

<div id="content">
  {% block content %}{% endblock %}
</div>

<div id="dev-warning" title="You have been warned.">
  <span class="text-danger">
    <strong>fiddlr is presently under development</strong>
  </span>
</div>

{% endblock %}

{% block thirdparty_postscripts %}
  {{ block.super }}

  {% for ngPiece in ",-loader,-route,-cookies,-resource,-sanitize,-touch"|split:"," %}
    {% with ngFile=ngVersion|add:'angular'|add:ngPiece|add:'.min.js' %}
      {% if isProduction %}
        <script src="{{ ngCDN|add:ngFile }}"></script>
      {% else %}
        <script src="{% static '3p/ng/'|add:ngFile %}"></script>
      {% endif %}
    {% endwith %}
    {% if isProduction %}
      <script src="{{ ngCDN|add:ngVersion }}angular-mocks.js"></script>
    {% else %}
      <script src="{% static '3p/ng/'|add:ngVersion|add:'angular-mocks.js' %}"></script>
    {% endif %}
  {% endfor %}

  {# ~~~ no CDN ~~~ #}
  <script src="{% static '3p/scripts/ui-bootstrap-tpls-0.11.0.min.js' %}"></script>

  {% if isProduction %}
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
  {% else %}
    <script src="{% static '3p/scripts/underscore-min.js' %}"></script>
  {% endif %}

  <script src="http://maps.googleapis.com/maps/api/js?key={{ gmaps_api_key }}&sensor=true"></script>

  {# ~~~ no CDN ~~~ #}
  <script src="{% static '3p/scripts/angular-google-maps.min.js' %}"></script>
{% endblock %}

{% block default_postscripts %}
  {{ block.super }}

  {% for appfile in "app.js,controllers.js"|split:"," %}
    <script src="{% static 'my/scripts/ng/'|add:appfile %}"></script>
  {% endfor %}

{% endblock %}
