{% extends "base.html" %}
{% load staticfiles misc %}


{% block body_attributes %}ng-app="fiddlrApp"{% endblock %}


{% block super_content %}
<div id="header" ng-controller="CommonHeaderController">
  <div class="container full-width">
    <div class="row">
      <div class="col-sm-2 col-xs-3">
        <div class="ib vmid fiddlr-title">
          <a href="{% url 'Front' %}">fiddlr</a>
        </div>
      </div>
      {% if page != "front" %}
      <div class="hidden-xs">
        <div class="col-sm-6">
          <form action="{% url 'Search' %}" method="POST">
            {% csrf_token %}
            <div class="ib vmid">
              {#<input type="text" placeholder="what?">#}
              {{ search_form.what }}
            </div>
            <div class="ib vmid">
              {#<input type="text" placeholder="where?">#}
              {{ search_form.where }}
            </div>
            <div class="ib vmid">
              <button class="btn btn-sm btn-default search-button"
                      type="submit">
                <span class="glyphicon glyphicon-search"></span>
              </button>
            </div>
          </form>
        </div>
      </div>
      <div class="col-sm-4 col-xs-9">
        <div class="ib vmid" id="alerts-icon">
          <a class="btn btn-sm btn-default"
             href="{% url 'Alerts' %}">
            <span class="glyphicon glyphicon-bell"></span>
            <span class="badge">482</span>
          </a>
        </div>
        <div class="ib vmid" id="header-links">
          <div class="btn-group">
            <button type="button" class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown">
              <span class="hidden-xs hidden-sm">Pages</span>
              <span class="glyphicon glyphicon-chevron-down"></span>
            </button>
            <ul class="dropdown-menu menu-align-right-edge" role="menu">
              {% for link in "Home,,Explore,Create,Connect,,About,Copyright,Help,Ads"|split:"," %}
                {% if link == "" %}
                  <li role="presentation" class="divider"></li>
                {% else %}
                  <li role="presentation">
                    <a href="{% url link %}" role="menuitem" tabindex="-1">
                      {{ link }}
                    </a>
                  </li>
                {% endif %}
              {% endfor %}
            </ul>
          </div>
        </div>
        <div class="ib vmid">
          {% if user.is_authenticated %}
          <form action="{% url 'Logout' %}" method="POST">
            {% csrf_token %}
            <input type="hidden" name="next" value="/" />
            <button class="btn btn-sm btn-primary">
              sign out
            </button>
          </form>
          {% else %}
          <script type="text/ng-template" id="login-modal.html">
            <div class="modal-header">
              <h3 class="modal-title">Sign into fiddlr</h3>
            </div>
            <form action="{% url 'Login' %}" method="POST">
              <div class="modal-body">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.get_full_path }}" />
                <p><input type="text" name="username" placeholder="username"></p>
                <p><input type="password" name="password" placeholder="password"></p>
              </div>
              <div class="modal-footer">
                <button class="btn btn-default" ng-click="jk()">Cancel</button>
                <button type="submit" class="btn btn-primary">Sign in</button>
              </div>
            </form>
          </script>
          <button class="btn btn-sm btn-primary"
                  ng-click="openLoginModal()">
            sign in/up
          </button>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div><!--/#header-->

<div id="content">
  {% block content %}{% endblock %}
</div>

<div id="dev-warning" title="You have been warned.">
  <span class="text-danger">
    <strong>fiddlr is presently under development</strong>
  </span>
</div>

{% endblock %}

{% block thirdparty_postscripts %}
  {{ block.super }}

  {% for ngPiece in ",-loader,-route,-cookies,-resource,-sanitize,-touch"|split:"," %}
    {% with ngFile=ngVersion|add:'angular'|add:ngPiece|add:'.min.js' %}
      {% if isProduction %}
        <script src="{{ ngCDN|add:ngFile }}"></script>
      {% else %}
        <script src="{% static '3p/ng/'|add:ngFile %}"></script>
      {% endif %}
    {% endwith %}
    {% if isProduction %}
      <script src="{{ ngCDN|add:ngVersion }}angular-mocks.js"></script>
    {% else %}
      <script src="{% static '3p/ng/'|add:ngVersion|add:'angular-mocks.js' %}"></script>
    {% endif %}
  {% endfor %}

  {# ~~~ no CDN ~~~ #}
  <script src="{% static '3p/scripts/ui-bootstrap-tpls-0.11.0.min.js' %}"></script>

  {% if isProduction %}
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
  {% else %}
    <script src="{% static '3p/scripts/underscore-min.js' %}"></script>
  {% endif %}

  <script src="http://maps.googleapis.com/maps/api/js?key={{ gmaps_api_key }}&sensor=true"></script>

  {# ~~~ no CDN ~~~ #}
  <script src="{% static '3p/scripts/angular-google-maps.min.js' %}"></script>
{% endblock %}

{% block default_postscripts %}
  {{ block.super }}

  {% for appfile in "app.js,controllers.js"|split:"," %}
    <script src="{% static 'my/scripts/ng/'|add:appfile %}"></script>
  {% endfor %}

{% endblock %}
